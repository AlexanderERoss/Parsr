## Required dependencies
`python3 -m pip install spacy`
`python3 -m pip install markdown`
`python3 -m pip install imblearn`
`python3 -m pip install sklearn_porter`
`python3 -m pip install scikit-learn==0.22.2`
`python3 -m spacy download en_core_web_sm`

## Building the Dataset

To build the dataset used to train the model run `python3 build_dataset.py <markdown folder> <json folder> <output folder>`.

**markdown folder:**\
It contains markdown files corresponding to the documents to annotate. The headings are used to generate the training labels for heading detection.

**json folder:**\
It contains json files as produced by Parsr. Each file must correspond to a file in the markdown folder. It must have the same name but use the .json extension instead of .md.

**output:**\
For each document, the script generates a corresponding csv in the output folder. The csv contains 6 columns:
1. line: the line as extracted by Parsr. It should correspond to a line in the pdf document.
2. is_font_bigger: a boolean indicating if the line has a bigger font size compare to the most common font in the document.
3. is_different_style: a boolean indicating if the line has a different font weight compare to the most common font in the document.
4. is_font_unique: a boolean indicating if the line has only one font.
5. is_title_case: a boolean indicating whether the line is written in title case. This is mostly valid only for English.
6. label: "paragraph" or "heading"

```
usage: build_dataset.py [-h] md_dir json_dir out_dir

Extracts features to csv from .json files using .md files as labels

positional arguments:
  md_dir      folder containing the .md files (labels)
  json_dir    folder containing the .json files (data)
  out_dir     folder in which to save the .csv files

optional arguments:
  -h, --help  show this help message and exit
```

## Training the Model

To train the model run `python3 train_dt.py <csv folder> <output folder>`.

**csv folder**:\
It contains the csv generated by `build_dataset.py` and must contain csv files formatted as described previously.

**output**:\
The script generates a file name `model.js` containing an executable model. This script should be placed in `server/src/processing/MLHeadingDetectionModule/train_model`.

```
usage: train_dt.py [-h] dataset_dir out_dir

Train a decision tree to recognize headings.

positional arguments:
  dataset_dir  folder containing the .csv files generated by build_dataset.py
  out_dir      folder in which to save the trained model

optional arguments:
  -h, --help   show this help message and exit
```